<html>
	<head>
		<link rel="stylesheet" href="styles/game_menu.css" type="text/css">
	</head>
	<body>
		<div id="canvas_field" style="position: relative; width: 800; height:800">
			<canvas id="game_field" class="canvas" width="800" height="800" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
			<canvas id="map" class="canvas" width="800" height="800" style="position: absolute; left: 0; top: 0; z-index: -2;"></canvas>
			<canvas id="meta" class="canvas"width="800" height="800" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
		</div>
		<div class="game_menu" id="towers" style="position: relative;">
			<div class="header">
				<input id="timer" readonly>
				<output class="round">  round: 1  </output>
				<output class="game_state">  BUILD   </output>
				<output class="player_info" id="player_hp"> 20 </output>
				<img src="styles/hp.png" id="hp_img">
				<output class="player_info" id="player_budget"> 2000 </output>
				<img src="styles/money.png" id="money_img">
				<button class="exit"> EXIT </button>
			</div>
			<div class="objects_fields" id="towers_container">
				<div class="container">
					<button id="tb1" class="button"> 1 </button>
					<button id="tb2" class="button"> 2 </button>
					<button id="tb3" class="button"> 3 </button>
				</div>	
				<input class="info" id="towerInfo" readonly>
				<button class="action_button" id="tower_upgrade"> UPGRADE </button>
				<button class="action_button" id="sell"> SELL </button>
			</div>
			<div class="objects_fields">
				<div class="container">
					<button id="eb1" class="button"> 1 </button>
					<button id="eb2" class="button"> 2 </button>
					<button id="eb3" class="button"> 3 </button>
				</div>
				<input class="info" id="enemyInfo" readonly>	
			</div>
		</div>
		<script type="text/javascript" src="constant.js"></script>
		<script type="text/javascript" src="engine/drawer.js"></script>
		<script type="text/javascript" src="engine/map.js"></script>
		<script type="text/javascript" src="engine/game_object.js"></script>
		<script type="text/javascript" src="engine/math_helper.js"></script>
		<script type="text/javascript" src="enemy.js"></script>
		<script type="text/javascript" src="tower.js"></script>
		<script type="text/javascript" src="bullet.js"></script>
		<script type="text/javascript" src="game_session.js"></script>
		<script type="text/javascript" src="event_handler.js"></script>
		<script type="text/javascript" src="engine/UI.js"></script>
		<script type="text/javascript" src="player.js"></script>
	
		<script type="text/javascript">



			let map_src = [
				"###........qp........###",
				"##xxxxxxxxx,,xxxxxxxxx##",
				",xxxxxxxxxx,,xxxxxxxxxx,",
				",xxp....qxx,,xxp....qxx,",
				",xx,xxxx,xx,,xx,xxxx,xx,",
				",xx,xxxx,xx,,xx,xxxx,xx,",
				",xx,xxxx,xx,,xx,xxxx,xx,",
				",xx,xxxx,xx,,xx,xxxx,xx,",
				",xx,xxxx,xpdbqx,xxxx,xx,",
				",xx,xxxx,x,xx,x,xxxx,xx,",
				"b..dxxxxb.weew.dxxxxb..d",
				"xxxxxxxxxxavvsxxxxxxxxxx",
				"xxxxxxxxxxavvsxxxxxxxxxx",
				"p..qxxxxp.wccw.qxxxxp..q",
				",xx,xxxx,x,xx,x,xxxx,xx,",
				",xx,xxxx,xbqpdx,xxxx,xx,",
				",xx,xxxx,xx,,xx,xxxx,xx,",
				",xx,xxxx,xx,,xx,xxxx,xx,",
				",xx,xxxx,xx,,xx,xxxx,xx,",
				",xx,xxxx,xx,,xx,xxxx,xx,",
				",xxb....dxx,,xxb....dxx,",
				",xxxxxxxxxx,,xxxxxxxxxx,",
				"##xxxxxxxxx,,xxxxxxxxx##",
				"###........db........###",
			];

			let new_map = map_src.slice();

			let map_ctx = document.getElementById("map").getContext("2d");
			let game_field_ctx = document.getElementById("game_field").getContext("2d");
			let meta_ctx = document.getElementById("meta").getContext("2d"); 

			let map_drawer = new Drawer(map_ctx, CANVAS_WIDTH, CANVAS_HEIGHT);
			let objects_drawer = new Drawer(game_field_ctx, CANVAS_WIDTH, CANVAS_HEIGHT);
			let meta_drawer = new Drawer(meta_ctx, CANVAS_WIDTH, CANVAS_HEIGHT);

			let session = new GameSession(map_drawer, objects_drawer, meta_drawer);
			session.set_map(MAP_WIDTH, MAP_HEIGHT, map_src);

			let player = session.add_player(0, 2 * 32);
			let bot = session.add_player(21 * 32, 23 * 32);

			session.add_path(player, bot, [[11, 0, 1, 0], [11, 8, 0, 1], [10, 8, -1, 0], [10, 10, 0, 1],
				                         [13, 10, 1, 0], [13, 13, 0, 1], [15, 13, 1, 0], [15, 20, 0, 1],
				                         [20, 20, 1, 0], [20, 13, 0, -1], [23, 13, 1, 0], 
				                         [23, 22, 0, 1], [0, 0, 0, 0]]);
			session.add_path(bot, player, [[11, 23, -1, 0], [11, 14, 0, -1], [13, 14, 1, 0], 									[13, 9, 0, -1], [7, 9, -1, 0], [7, 2, 0, -1],
										[2, 2, -1, 0], [2, 10, 0, 1], [-1, 10, -1, 0],
										[-1, -1, 0, -1], [0, 0, 0, 0]]);

			session.render_map();

			var id_timer2 = setInterval(function(){session.spawn_enemy(bot, player)}, 500);
			session.start_building();
			session.render_scene();
		</script>

	</body>
</html>

