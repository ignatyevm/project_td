<html>
	<head>
	</head>
	<body>

		<canvas id="game_field" width="900" height="900" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
		<canvas id="map" width="900" height="900" style="position: absolute; left: 0; top: 0; z-index: -2;"></canvas>
		<canvas id="meta" width="900" height="900" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>

		<script type="text/javascript" src="engine/drawer.js"></script>
		<script type="text/javascript" src="engine/map.js"></script>
		<script type="text/javascript" src="engine/game_object.js"></script>
		<script type="text/javascript" src="engine/math_helper.js"></script>
		<script type="text/javascript">
			
			let square = [[0, 0], [1, 0], [1, 1], [0, 1]];
			let point = [0.25, 0.25];
			console.log(intersection_square(square, point));		
		</script>
		<script type="text/javascript" src="enemy.js"></script>
		<script type="text/javascript" src="tower.js"></script>
		<script type="text/javascript" src="bullet.js"></script>
		<script type="text/javascript" src="game_session.js"></script>
	
		<script type="text/javascript">

			const CANVAS_WIDTH = 900
			const CANVAS_HEIGHT = 900;

			const SPRITE_WIDTH = 36;
			const SPRITE_HEIGHT = 36;

			const BLOCK_SIZE = 36;

			let map_src = [
				"xxxxxxxxxxxxxxxxxxxxxxxxx",
				".............txxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxxb...........",
			];

			let map_ctx = document.getElementById("map").getContext("2d");
			let game_field_ctx = document.getElementById("game_field").getContext("2d");
			let meta_ctx = document.getElementById("meta").getContext("2d"); 

			let map_drawer = new Drawer(map_ctx, CANVAS_WIDTH, CANVAS_HEIGHT);
			let objects_drawer = new Drawer(game_field_ctx, CANVAS_WIDTH, CANVAS_HEIGHT);
			let meta_drawer = new Drawer(meta_ctx, CANVAS_WIDTH, CANVAS_HEIGHT);

			let session = new GameSession(map_drawer, objects_drawer, meta_drawer);
			session.set_map(5, 25, map_src);
			session.render_map();

			var id_timer = setInterval(function(){session.spawn_enemy(0, BLOCK_SIZE, [[13, 1, 2, 0], [13, 4, 0, 2], [25, 4, 2, 0], [0, 0, 0, 0]], 3)}, 2000);

			session.build_tower(12 * BLOCK_SIZE, 2 * BLOCK_SIZE);
			session.build_tower(5 * BLOCK_SIZE, 2 * BLOCK_SIZE);
			session.build_tower(20 * BLOCK_SIZE, 2 * BLOCK_SIZE);

			session.render_scene();

		</script>

	</body>
</html>
