<html>
	<head>
		<link rel="stylesheet" href="styles/game_menu.css" type="text/css">
	</head>
	<body>
		<div class="game_menu">
			<div class="header">
				<input class="timer" readonly value="00:59">
				<output class="round">  round: 1  </output>
				<output class="game_state">  BUILD   </output>
				<output class="player_info" id="player_hp"> 20 </output>
				<img src="styles/hp.png" width="20" height="20">
				<output class="player_info" id="player_budget"> 2000$ </output>
				<img src="styles/money.png" width="25" height="25">
				<button class="exit"> EXIT </button>
			</div>
			<div class="objects_fields">
				<div class="container">
					<button id="tb1"> 1 </button>
					<button id="tb2"> 2 </button>
					<button id="tb3"> 3 </button>
				</div>	
				<input class="info" id="towerInfo" readonly>
				<button class="action_button" id="tower_upgrade"> UPGRADE </button>
				<button class="action_button" id="sell"> SELL </button>
			</div>
			<div class="objects_fields">
				<div class="container">
					<button> 1 </button>
					<button> 2 </button>
					<button> 3 </button>
				</div>
				<input class="info" id="enemyInfo" readonly>	
				<button class="action_button" id="spawn_enemy"> ATTACK </button>
			</div>
		<canvas id="game_field" width="900" height="900" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
		<canvas id="map" width="900" height="900" style="position: absolute; left: 0; top: 0; z-index: -2;"></canvas>
		<canvas id="meta" width="900" height="900" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>

		<script type="text/javascript" src="engine/drawer.js"></script>
		<script type="text/javascript" src="engine/map.js"></script>
		<script type="text/javascript" src="engine/game_object.js"></script>
		<script type="text/javascript" src="engine/math_helper.js"></script>
		<script type="text/javascript" src="enemy.js"></script>
		<script type="text/javascript" src="tower.js"></script>
		<script type="text/javascript" src="bullet.js"></script>
		<script type="text/javascript" src="game_session.js"></script>
		<script type="text/javascript" src="event_handler.js"></script>
		<script type="text/javascript" src="engine/UI.js"></script>
	
		<script type="text/javascript">
			
			const CANVAS_WIDTH = 900
			const CANVAS_HEIGHT = 900;

			const MAP_WIDTH = 25;
			const MAP_HEIGHT = 25;

			const SPRITE_WIDTH = 32;
			const SPRITE_HEIGHT = 32;

			const BLOCK_SIZE = 32;

			const FIRST_FRAME = 1;
			const SECOND_FRAME = 2;
			const THIRD_FRAME = 3;
			const FORTH_FRAME = 4;

			let map_src = [
				"xxxxxxxxxxxxxxxxxxxxxxxxx",
				"xxxxxxxxxxxxxxxxxxxxxxxxx",
				"b............/xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx,xxxxxxxxxxx",
				"xxxxxxxxxxxxx*..........b",
				"xxxxxxxxxxxxxxxxxxxxxxxxx",
				"xxxxxxxxxxxxxxxxxxxxxxxxx",
			];

			let new_map = map_src.slice();

			let map_ctx = document.getElementById("map").getContext("2d");
			let game_field_ctx = document.getElementById("game_field").getContext("2d");
			let meta_ctx = document.getElementById("meta").getContext("2d"); 

			let map_drawer = new Drawer(map_ctx, CANVAS_WIDTH, CANVAS_HEIGHT);
			let objects_drawer = new Drawer(game_field_ctx, CANVAS_WIDTH, CANVAS_HEIGHT);
			let meta_drawer = new Drawer(meta_ctx, CANVAS_WIDTH, CANVAS_HEIGHT);

			let session = new GameSession(map_drawer, objects_drawer, meta_drawer);
			session.set_map(MAP_WIDTH, MAP_HEIGHT, map_src);
			session.render_map();

			var id_timer = setInterval(function(){session.spawn_enemy(0, 2 * BLOCK_SIZE, [[13, 2, 3, 0], [13, 22, 0, 2], [24, 22, 2, 0], [0, 0, 0, 0]], 3)}, 5000);

			//session.build_tower(12 * BLOCK_SIZE, 3 * BLOCK_SIZE);
			//session.build_tower(5 * BLOCK_SIZE, 3 * BLOCK_SIZE);
			//session.build_tower(12 * BLOCK_SIZE, 8 * BLOCK_SIZE);

			session.render_scene();
		</script>

	</body>
</html>
