"use strict";

const WIDTH = 36;
const HEIGHT = 36;
const CHAR_UP = ".";
const CHAR_FILL = "#";
const CHAR_ROAD = "0";
const CHAR_LEFT = "n";
const CHAR_DOWN = "c";
const CHAR_RIGHT = "z";
const CHAR_LEFT_UP = "s";

const CHAR_LEFT_DOWN = "x";
const CHAR_RIGHT_DOWN = "b";
const CHAR_LEFT_UP_TURN = "m";
const CHAR_RIGHT_UP_TURN = "v";
const CHAR_LEFT_DOWN_TURN = "d";
const CHAR_RIGHT_DOWN_TURN = "a";

const CHAR_TO_SPRITE = {
	".": "sprites/towerDefense_tile080.png",
	"x": "sprites/towerDefense_tile081.png",
	"#": "sprites/towerDefense_tile129.png",
	"0": "sprites/towerDefense_tile034.png",
	"z": "sprites/towerDefense_tile104.png",
	"c": "sprites/towerDefense_tile126.png",
	"v": "sprites/towerDefense_tile083.png",
	"b": "sprites/towerDefense_tile079.png",
	"n": "sprites/towerDefense_tile102.png",
	"m": "sprites/towerDefense_tile082.png",
	"a": "sprites/towerDefense_tile106.png",
	"s": "sprites/towerDefense_tile127.png",
	"d": "sprites/towerDefense_tile105.png",
	"f": "sprites/towerDefense_tile125.png",
}

var id_timer;

class MapManager{

	constructor(static_image, source_str) {
		this.static_image = static_image;
		this.width = WIDTH;
		this.height = HEIGHT;

		this.map_container = new Array(this.height);

		for(let i = 0; i < WIDTH; i++) {
			this.map_container[i] = new Array(this.width);
			for(let j = 0; j < HEIGHT; j++) {
				this.map_container[i][j] = CHAR_TO_SPRITE[source_str[i][j]];
			}
		}
	}
}

var mas = [[".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "x", "#", "#", "#", "#", "#", "#", "#", 
            "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#"],
		   ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "z", "#", "#", "#", "#", "#", "#", "#", 
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#"],
		   ["c", "c", "c", "c", "c", "c", "c", "c", "v", "0", "z", "#", "#", "#", "#", "#", "b", ".", 
		    ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "x", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "m", "c", "c", "c", "c", "c", "c", "c", "c", "c", "v", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "b", ".", ".", ".", ".", "a", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "n", "0", "0", "0", "0", "0", "0", "z", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "n", "0", "m", "c", "c", "c", "c", "s", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "n", "0", "d", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "a", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "n", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0",
		    "z", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "f", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c",
		    "s", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "z", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "d", ".", ".", ".", ".", "."],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "n", "0", "0", "0", "0", "0", "0", "0"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "f", "c", "c", "c", "c", "c", "c", "c"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#"],
		   ["#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#",
		    "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#", "#"]];

var canvas = document.getElementById('game_fild'),
ctx = canvas.getContext('2d');

var static_image = new Image();
static_image.src = "maps/map_4.png";

var map_manager = new MapManager(static_image, mas);

function render_map() {
	for (let i = 0; i < map_manager.width; ++i) {
		for (let j = 0; j < map_manager.height; ++j) {
			let tmp_image = new Image();
			tmp_image.src = map_manager.map_container[i][j];
			tmp_image.onload = function(){
		    	ctx.drawImage(tmp_image, j * 20, i * 20, 20, 20);
		  	}
		}
	}
}

(function test(){
	static_image.onload = function(){
    	ctx.drawImage(static_image, 0, 0);
  	}
	id_timer = setInterval(render_map, 50);
})()
